<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://zatoima.github.io/favicon.ico><title>Oracle GoldenGateの仮想メモリの使い方を整理する | my opinion is my own</title><meta name=title content="Oracle GoldenGateの仮想メモリの使い方を整理する"><meta name=description content><meta name=keywords content="GoldenGate,Oracle,"><meta property="og:title" content="Oracle GoldenGateの仮想メモリの使い方を整理する"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://zatoima.github.io/goldengate-vmemory-use.html"><meta property="og:image" content="https://zatoima.github.io/images/share.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2019-04-20T00:00:00+00:00"><meta property="article:modified_time" content="2019-04-20T00:00:00+00:00"><meta property="og:site_name" content="my opinion is my own"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zatoima.github.io/images/share.png"><meta name=twitter:title content="Oracle GoldenGateの仮想メモリの使い方を整理する"><meta name=twitter:description content><meta itemprop=name content="Oracle GoldenGateの仮想メモリの使い方を整理する"><meta itemprop=description content><meta itemprop=datePublished content="2019-04-20T00:00:00+00:00"><meta itemprop=dateModified content="2019-04-20T00:00:00+00:00"><meta itemprop=wordCount content="341"><meta itemprop=image content="https://zatoima.github.io/images/share.png"><meta itemprop=keywords content="GoldenGate,Oracle,"><meta name=referrer content="no-referrer-when-downgrade"><link rel=alternate type=text/plain href=/llms.txt title=LLMs.txt><link rel=alternate type=text/plain href=/llms-full.txt title=LLMs-full.txt><script>(function(){var e=localStorage.getItem("theme");(e==="dark"||!e&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.documentElement.setAttribute("data-theme","dark")})()</script><link rel=stylesheet href=/css/zenn.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-STFZ9QMXGM"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-STFZ9QMXGM")</script></head><body><div class=site-wrapper><header class=site-header><div class=header-inner><a href=/ class=site-logo>my opinion is my own</a><nav class=header-nav><a href=/about/>About</a>
<a href=/blog/>Blog</a>
<a href=/index.xml>RSS</a>
<a href=/other/>Other</a>
<a href=/llms.txt title="LLMs.txt - AI/LLM向けサイト情報">llms.txt</a></nav><div class=header-actions><button id=search-btn class=header-icon-btn aria-label=検索><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg></button>
<button id=dark-mode-btn class=header-icon-btn aria-label=ダークモード切替>🌙</button>
<button id=hamburger-btn class=hamburger-btn aria-label=メニュー>
<span></span><span></span><span></span></button></div></div></header><div id=search-overlay class=search-overlay><div class=search-modal><input type=text id=search-input class=search-input placeholder="記事を検索... (Ctrl+K)" autocomplete=off><div id=search-results class=search-results></div></div></div><div id=nav-overlay class=nav-overlay></div><main class=site-main><div class=article-layout><article class=article-main><nav class=breadcrumb aria-label=パンくずリスト><a href=/>ホーム</a>
<span class=breadcrumb-sep>></span>
<a href=/blog/>Blog</a>
<span class=breadcrumb-sep>></span>
<span class=breadcrumb-current>Oracle GoldenGateの仮想メモリの使い方を整理する</span></nav><div class=article-card><div class=article-header><div class=article-emoji><img src=/images/tags/goldengate.svg alt=GoldenGate class=tag-icon loading=lazy></div><h1>Oracle GoldenGateの仮想メモリの使い方を整理する</h1><div class=article-meta><time class=article-date datetime=2019-04-20>2019/04/20 に公開</time>
<span class=reading-time>📖 約1分</span></div><div class=article-tags><a href=https://zatoima.github.io/blog/goldengate/ class=tag-badge><img src=/images/tags/goldengate.svg alt=GoldenGate class=tag-badge-icon loading=lazy>GoldenGate</a>
<a href=https://zatoima.github.io/blog/oracle/ class=tag-badge><img src=/images/tags/oracle.svg alt=Oracle class=tag-badge-icon loading=lazy>Oracle</a></div></div><div class=article-content><h4 id=はじめに><strong>はじめに</strong></h4><p>GoldenGateもOS上で動作するミドルウェアなので物理メモリ/仮想メモリを使用します。</p><p>GoldenGateはコミットされたトランザクションのみをレプリケートするため、トランザクションのコミットまたはロールバックを受信するまで、<em>キャッシュ</em>と呼ばれる<code>管理仮想メモリー・プール</code>に各トランザクションの操作を保持する必要があります。ここで述べているのは物理メモリではなく仮想メモリです。ご注意ください。</p><p>本記事で明示的に指定していない場合は、メモリという言葉は仮想メモリを指します。</p><p>GoldenGateプロセスによって使用される物理メモリーの実際の量は、オペレーティング・システムによって制御されます。</p><p>具体的なメモリの使い方と使用されるスワップ容量については本記事では扱いません。</p><h4 id=必要な仮想メモリ量について><strong>必要な仮想メモリ量について</strong></h4><p>仮想メモリの見積もり式は下記の通りマニュアルに記載があります。</p><blockquote><p><a href=https://docs.oracle.com/cd/E74358_01/gg-winux/GWURF/GUID-B910F3D9-E41C-4335-AC0A-442435481A19.htm>https://docs.oracle.com/cd/E74358_01/gg-winux/GWURF/GUID-B910F3D9-E41C-4335-AC0A-442435481A19.htm</a></p><p>CACHEMGR</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>1. 1つのExtractプロセスおよび1つのReplicatプロセスを起動します。
</span></span><span style=display:flex><span>2. GGSCIを実行します。
</span></span><span style=display:flex><span>3. 実行中の各プロセスのレポート・ファイルを表示し、PROCESS VM AVAIL FROM OS (min)行を探します。
</span></span><span style=display:flex><span>4. 必要な場合、各値を次の整数(GB)に切り上げます。たとえば、1.76GBの場合は2GBに切り上げます。
</span></span><span style=display:flex><span>5. 繰り上げられたExtractの値に、Extractプロセスの数を掛けます。
</span></span><span style=display:flex><span>6. 繰り上げられたReplicatの値に、Replicatプロセスの数を掛けます。
</span></span><span style=display:flex><span>7. 2つの結果に、システム上のOracle GoldenGateプロセスおよびその他のプロセスで必要とする追加スワップ領域を足します。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(PROCESS_VM x number_Extracts) + (PROCESS_VM x number_Replicats) + (swap_for_other_processes) = max_swap_space_on_system
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>この合計が、これらのプロセスに必要な最大スワップ領域になります。すべてのOracle GoldenGateプロセスが使用する実際の物理メモリー量は、Oracle GoldenGateプロセスではなく、オペレーティング・システムによって制御されます。グローバル・キャッシュ・サイズは、CACHEMGRのCACHESIZEオプションで制御します。
</span></span></code></pre></div><h4 id=仮想メモリ動作><strong>仮想メモリ動作</strong></h4><p>下記はプロセス起動時にレポートファイルに出力されるメモリの統計値です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>CACHEMGR virtual memory values (may have been adjusted)
</span></span><span style=display:flex><span>CACHEPAGEOUTSIZE (default):               4M
</span></span><span style=display:flex><span>PROCESS VM AVAIL FROM OS (min):           2G
</span></span><span style=display:flex><span>CACHESIZEMAX (strict force to disk):   1.74G
</span></span></code></pre></div><p>仮想メモリ上限値を設定したい場合、CACHESIZEパラメータを設定します。これはプロセスがトランザクション・データのキャッシュに使用できる仮想メモリーの弱い制限を示します。これは、PROCESS VM AVAIL FROM OS (min)の値に基づいて動的に決定されます。CACHEMGRのCACHESIZEオプションを使用して制御できます。トランザクション・データのキャッシングにできる仮想メモリー量(キャッシュ・サイズ)の弱い制限を指定するため、トランザクションによってはこのサイズを超えてメモリを使用するケースも存在します。この場合、上限値は上記の統計値で言うところの <code>CACHESIZEMAX</code>が上限となります。</p><p>次に、PROCESS VM AVAIL FROM OS (min)は、このプロセスが使用可能と判断したおおよその仮想メモリー量を示します。内部的な理由で、この量はオペレーティング・システムによって使用可能と表示される量より少ない場合があります。</p><p>CACHESIZEMAX (strict force to disk)は、PROCESS VM AVAIL FROM OSおよびCACHESIZEから導出されます。通常は、現在仮想メモリー・バッファが特定の内部値を超えているトランザクションのみがページングの候補です。メモリー・リクエストの合計がCACHESIZEの値を超えると、キャッシュ・マネージャはディスクに書き込むトランザクションを探し、ページング候補のリストからトランザクションを選択します。ページング候補のトランザクションがすでにディスクにページングされていて、使用中の仮想メモリーがCACHESIZEMAX (strict force to disk)を超えている場合は、追加のバッファを必要とするすべてのトランザクションをページング候補にできます。このような方法で、常に仮想メモリーの可用性が確保されています。</p><p>メモリ使用の上限を超える場合 GoldenGateインストール・ディレクトリの<code>dirtmp</code>サブディレクトリにトランザクション・データがスワップされます。</p><p>ロングトランザクションが実行される場合は設定しているCACHESIZE次第ですが、ディスクにスワップされる可能性が高いでディスク容量にも注意が必要と思われます。</p><h4 id=send-extract-capture名-cachemgr-cachestatsについて><strong>SEND EXTRACT &lt;Capture名>, CACHEMGR CACHESTATSについて</strong></h4><p>仮想メモリの使用状況について確認したい場合は下記コマンドを実行します。</p><p>多くの情報が出力されますが、「CACHE OBJECT MANAGER statistics」セクションを見てどのようなメモリ動作になっているか確認すれば良いと思います。ファイルキャッシュに関する情報は「CACHE File Caching」で確認可能です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GGSCI (dbvgg.jp.oracle.com as ggs@db112s) 40&gt; SEND EXTRACT c11, CACHEMGR CACHESTATS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Sending CACHEMGR request to EXTRACT C11 ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CACHE OBJECT MANAGER statistics
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CACHE MANAGER VM USAGE
</span></span><span style=display:flex><span>vm current     =      0    vm anon queues =      0
</span></span><span style=display:flex><span>vm anon in use =      0    vm file        =      0
</span></span><span style=display:flex><span>vm used max    =   1.27G   ==&gt; CACHE BALANCED
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CACHE CONFIGURATION
</span></span><span style=display:flex><span>cache size            =   1G   cache force paging = 1.74G
</span></span><span style=display:flex><span>buffer min            =  64K   buffer max (soft)  =   4M
</span></span><span style=display:flex><span>pageout eligible size =   4M
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>================================================================================
</span></span><span style=display:flex><span>RUNTIME STATS FOR SUPERPOOL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CACHE Transaction Stats
</span></span><span style=display:flex><span>trans active    =      0    max concurrent =    238
</span></span><span style=display:flex><span>non-zero total  =      1    trans total    =  42.58K
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CACHE File Caching
</span></span><span style=display:flex><span>filecache rqsts        =    129    bytes to disk      =   8.20G
</span></span><span style=display:flex><span>file retrieves         =   2.08K   objs filecached    =      1
</span></span><span style=display:flex><span>queue entries          =    129    queue processed    =    130
</span></span><span style=display:flex><span>queue entry not needed =      0    queue not signaled =      0
</span></span><span style=display:flex><span>fc requesting obj      =      0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CACHE MANAGEMENT
</span></span><span style=display:flex><span>buffer links   =   2.06K  anon gets   =      0
</span></span><span style=display:flex><span>forced unmaps  =     39   cnnbl try   =    200
</span></span><span style=display:flex><span>cached out     =    114
</span></span></code></pre></div><p>想定より多く仮想メモリを使用していることを疑われる場合は<code>CACHE MANAGER VM USAGE</code> を優先的に確認するのが良いと思います。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>CACHE MANAGER VM USAGE
</span></span><span style=display:flex><span>vm current = 1015M vm anon queues = 320M
</span></span><span style=display:flex><span>vm anon in use = 692M vm file = 3M
</span></span><span style=display:flex><span>vm used max = 1G ==&gt; CACHE BALANCED
</span></span></code></pre></div><h5 id=各項目の補足説明><strong>各項目の補足説明</strong></h5><ul><li>vm current : 現在割当てられている仮想メモリサイズ総量(メモリ＋ページング)</li><li>vm anon queues : vm current のうち、フリーなメモリサイズ(使用されなくなったメモリをフリーなメモリとして一旦キューに保持しているサイズ)</li><li>vm anon in use : 現在処理で利用中の仮想メモリサイズ総量</li><li>vm file : 現在ページングしているサイズ</li><li>vm used max : これまでに利用された仮想メモリサイズ総量の最大サイズ</li></ul></div></div><nav class=prev-next-nav><a href=https://zatoima.github.io/goldengate-classic-replicat-trace.html class="prev-next-link prev-link"><span class=prev-next-label>← 前の記事</span>
<span class=prev-next-title>GoldenGate Classic Replicatプロセスが適用するSQLの10046トレース取 …</span></a>
<a href=https://zatoima.github.io/goldengate-longtransaction-memoryuse.html class="prev-next-link next-link"><span class=prev-next-label>次の記事 →</span>
<span class=prev-next-title>ロングトランザクション時のGoldenGateのメモリの使用動作を検証する</span></a></nav><div class=share-buttons><span class=share-label>共有:</span>
<a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fzatoima.github.io%2fgoldengate-vmemory-use.html&text=Oracle&#43;GoldenGate%E3%81%AE%E4%BB%AE%E6%83%B3%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9%E3%82%92%E6%95%B4%E7%90%86%E3%81%99%E3%82%8B" target=_blank rel="noopener noreferrer" class="share-btn share-twitter" aria-label=Xで共有><svg width="18" height="18" viewBox="0 0 24 24" fill="currentcolor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href=https://b.hatena.ne.jp/entry/https://zatoima.github.io/goldengate-vmemory-use.html target=_blank rel="noopener noreferrer" class="share-btn share-hatena" aria-label=はてなブックマークに追加>B!</a></div><div class=related-articles><h2 class=related-articles-title>関連しているかもしれない記事</h2><ul class=related-list><li><a href=/goldengate-classic-replicat-trace.html>GoldenGate Classic Replicatプロセスが適用するSQLの10046トレース取得方法</a></li><li><a href=/goldengate-classic-replicat-create.html>GoldenGateのClassic Replicat(非統合Replicat)の作成手順</a></li><li><a href=/goldengate-opentransaction-getinfo.html>GoldenGateのコマンドを使用してオープントランザクションを特定する</a></li><li><a href=/goldengate-flashbackscn-instantiationSCN.html>expdp時にFLASHBACK_SCNを使用した場合のインスタンス化SCNについて</a></li><li><a href=/goldengate-12c-18c-install-implement.html>GoldenGateをインストールしてDB間のレプリケーション環境を構築する</a></li></ul></div><div class=post-tags><a href=https://zatoima.github.io/blog/goldengate/ class=tag-badge><img src=/images/tags/goldengate.svg alt=GoldenGate class=tag-badge-icon loading=lazy>GoldenGate</a>
<a href=https://zatoima.github.io/blog/oracle/ class=tag-badge><img src=/images/tags/oracle.svg alt=Oracle class=tag-badge-icon loading=lazy>Oracle</a></div></article><aside class=article-sidebar><div class=toc-container><div class=toc-title>目次</div><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#はじめに><strong>はじめに</strong></a></li><li><a href=#必要な仮想メモリ量について><strong>必要な仮想メモリ量について</strong></a></li><li><a href=#仮想メモリ動作><strong>仮想メモリ動作</strong></a></li><li><a href=#send-extract-capture名-cachemgr-cachestatsについて><strong>SEND EXTRACT &lt;Capture名>, CACHEMGR CACHESTATSについて</strong></a></li></ul></li></ul></li></ul></nav></div></aside></div></main><footer class=site-footer><div class=footer-inner><div class=footer-description>memo blog</div><div class=footer-links><a href=/>ホーム</a>
<a href=/blog/>記事一覧</a>
<a href=/tags/>タグ一覧</a>
<a href=/about/>About</a></div><div class=footer-social><a href=https://github.com/zatoima target=_blank rel="noopener noreferrer" aria-label=GitHub><svg width="18" height="18" viewBox="0 0 24 24" fill="currentcolor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></a><a href=https://x.com/zatoima1 target=_blank rel="noopener noreferrer" aria-label="X (Twitter)"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentcolor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href=/index.xml aria-label=RSS><svg width="16" height="16" viewBox="0 0 24 24" fill="currentcolor"><path d="M6.18 15.64a2.18 2.18.0 012.18 2.18c0 1.19-.98 2.18-2.18 2.18C5 20 4 19.01 4 17.82a2.18 2.18.0 012.18-2.18M4 4.44A15.56 15.56.0 0119.56 20h-2.83A12.73 12.73.0 004 7.27V4.44m0 5.66a9.9 9.9.0 019.9 9.9h-2.83A7.07 7.07.0 004 12.93V10.1z"/></svg></a></div><div class=footer-copyright>Copyright © 2019, zatoima.</div></div></footer></div><script src=/js/lightbox.js defer></script>
<script src=/js/toc-highlight.js defer></script>
<script src=/js/code-copy.js defer></script>
<script src=/js/dark-mode.js defer></script>
<script src=/js/mobile-nav.js defer></script>
<script src=/js/search.js defer></script></body></html>