<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://zatoima.github.io/favicon.ico" />
<title>SQL APIã‚’ä½¿ç”¨ã—ã¦Snowflakeã«SQLã‚’ç™ºè¡Œã™ã‚‹ | my opinion is my own</title>
<meta name="title" content="SQL APIã‚’ä½¿ç”¨ã—ã¦Snowflakeã«SQLã‚’ç™ºè¡Œã™ã‚‹" />
<meta name="description" content="" />
<meta name="keywords" content="Snowflake," />


<meta property="og:title" content="SQL APIã‚’ä½¿ç”¨ã—ã¦Snowflakeã«SQLã‚’ç™ºè¡Œã™ã‚‹" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zatoima.github.io/snowflake-sql-api-try/" /><meta property="og:image" content="https://zatoima.github.io/images/share.png"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-01-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-01-11T00:00:00+00:00" /><meta property="og:site_name" content="my opinion is my own" />




<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://zatoima.github.io/images/share.png"/>

<meta name="twitter:title" content="SQL APIã‚’ä½¿ç”¨ã—ã¦Snowflakeã«SQLã‚’ç™ºè¡Œã™ã‚‹"/>
<meta name="twitter:description" content=""/>



<meta itemprop="name" content="SQL APIã‚’ä½¿ç”¨ã—ã¦Snowflakeã«SQLã‚’ç™ºè¡Œã™ã‚‹">
<meta itemprop="description" content=""><meta itemprop="datePublished" content="2023-01-11T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-01-11T00:00:00+00:00" />
<meta itemprop="wordCount" content="1256"><meta itemprop="image" content="https://zatoima.github.io/images/share.png"/>
<meta itemprop="keywords" content="Snowflake," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <link rel="alternate" type="text/plain" href="/llms.txt" title="LLMs.txt" />
  <link rel="alternate" type="text/plain" href="/llms-full.txt" title="LLMs-full.txt" />

  <script>
    (function(){
      var t = localStorage.getItem('theme');
      if (t === 'dark' || (!t && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script><link rel="stylesheet" href="/css/zenn.css">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-STFZ9QMXGM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-STFZ9QMXGM');
</script>
</head>

<body>
  <div class="site-wrapper">
    <header class="site-header">
      <div class="header-inner">
        <a href="/" class="site-logo">my opinion is my own</a>
        <nav class="header-nav">
<a href="/about/">About</a>
<a href="/blog/">Blog</a>
<a href="/index.xml">RSS</a>
<a href="/other/">Other</a>
<a href="/llms.txt" title="LLMs.txt - AI/LLMå‘ã‘ã‚µã‚¤ãƒˆæƒ…å ±">llms.txt</a>
</nav>
        <div class="header-actions">
          <button id="search-btn" class="header-icon-btn" aria-label="æ¤œç´¢">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
          </button>
          <button id="dark-mode-btn" class="header-icon-btn" aria-label="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿">ğŸŒ™</button>
          <button id="hamburger-btn" class="hamburger-btn" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
            <span></span><span></span><span></span>
          </button>
        </div>
      </div>
    </header>

    
    <div id="search-overlay" class="search-overlay">
      <div class="search-modal">
        <input type="text" id="search-input" class="search-input" placeholder="è¨˜äº‹ã‚’æ¤œç´¢... (Ctrl+K)" autocomplete="off">
        <div id="search-results" class="search-results"></div>
      </div>
    </div>

    
    <div id="nav-overlay" class="nav-overlay"></div>

    <main class="site-main">
<div class="article-layout">
  <article class="article-main">
    
    <nav class="breadcrumb" aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ">
  <a href="/">ãƒ›ãƒ¼ãƒ </a>
  <span class="breadcrumb-sep">&gt;</span>
  
  <a href="/blog/">Blog</a>
  <span class="breadcrumb-sep">&gt;</span>
  
  <span class="breadcrumb-current">SQL APIã‚’ä½¿ç”¨ã—ã¦Snowflakeã«SQLã‚’ç™ºè¡Œã™ã‚‹</span>
</nav>

    
    <div class="article-card">
      <div class="article-header">
        <div class="article-emoji"><img src="/images/tags/snowflake.svg" alt="Snowflake" class="tag-icon" loading="lazy"></div>
        <h1>SQL APIã‚’ä½¿ç”¨ã—ã¦Snowflakeã«SQLã‚’ç™ºè¡Œã™ã‚‹</h1>
        
        <div class="article-meta">
          <time class="article-date" datetime='2023-01-11'>
            2023/01/11 ã«å…¬é–‹
          </time>
          
          
          
          <span class="reading-time">ğŸ“– ç´„2åˆ†</span>
        </div>
        <div class="article-tags">
          
          <a href="https://zatoima.github.io/blog/snowflake/" class="tag-badge"><img src="/images/tags/snowflake.svg" alt="Snowflake" class="tag-badge-icon" loading="lazy">Snowflake</a>
          
        </div>
        
      </div>
      <div class="article-content">
        <h3 id="ã‚­ãƒ¼ãƒšã‚¢èªè¨¼ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šå¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆ">ã‚­ãƒ¼ãƒšã‚¢èªè¨¼ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šå¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆ</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> ~/.ssh
</span></span><span style="display:flex;"><span>openssl genrsa <span style="color:#bd93f9">2048</span> | openssl pkcs8 -topk8 -inform PEM -out snowflake_tf_snow_key.p8 -nocrypt
</span></span><span style="display:flex;"><span>openssl rsa -in snowflake_tf_snow_key.p8 -pubout -out snowflake_tf_snow_key.pub
</span></span></code></pre></div><p><code>snowflake_tf_snow_key.pub</code>ã®æ–‡å­—åˆ—ã‚’å–å¾—ã—ã¦æ¬¡ã®SQLã®<code>RSA_PUBLIC_KEY_HERE</code>ã«è²¼ã‚Šä»˜ã‘ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">USER</span> sqlapiuser RSA_PUBLIC_KEY<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;RSA_PUBLIC_KEY_HERE&#39;</span> DEFAULT_ROLE<span style="color:#ff79c6">=</span><span style="color:#ff79c6">PUBLIC</span> MUST_CHANGE_PASSWORD<span style="color:#ff79c6">=</span><span style="color:#ff79c6">FALSE</span>;
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- CREATE USER sqlapiuser RSA_PUBLIC_KEY=&#39;MIIBXnmXXXXXXXXXXXXXXXXXXf7Z4EqXXXXXXXXXXXB&#39; DEFAULT_ROLE=PUBLIC MUST_CHANGE_PASSWORD=FALSE;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">GRANT</span> <span style="color:#ff79c6">ROLE</span> SYSADMIN <span style="color:#ff79c6">TO</span> <span style="color:#ff79c6">USER</span> sqlapiuser;
</span></span></code></pre></div><h4 id="æ¥ç¶šç¢ºèªã‚’è¡Œã†">æ¥ç¶šç¢ºèªã‚’è¡Œã†</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>snowsql <span style="color:#ff79c6">-</span>a <span style="color:#ff79c6">&lt;</span>ACCOUNTå<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">-</span>u sqlapiuser <span style="color:#6272a4">--private-key-path /Users/jimazato/.ssh/snowflake_tf_snow_key.p8
</span></span></span></code></pre></div><h3 id="jwtç”Ÿæˆã‚’è¡Œã†">JWTç”Ÿæˆã‚’è¡Œã†</h3>
<p>ä¸‹è¨˜ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«ã‚‚è¨˜è¼‰ãŒã‚ã‚‹é€šã‚Šã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆç”¨ã®èªè¨¼æƒ…å ±ã§ã‚ã‚‹ JSON Web ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆJWTï¼‰ã‚’ç”Ÿæˆã™ã‚‹</p>
<blockquote>
<p><a href="https://docs.snowflake.com/ja/developer-guide/sql-api/authenticating.html">Authenticating to the Server for the SQL API â€” Snowflake Documentation</a></p>
</blockquote>
<p><code>sql-api-generate-jwt.py</code>ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># To run this on the command line, enter:</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#   python3 sql-api-generate-jwt.py --account=&lt;account_identifier&gt; --user=&lt;username&gt; --private_key_file_path=&lt;path_to_private_key_file&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> cryptography.hazmat.primitives.serialization <span style="color:#ff79c6">import</span> load_pem_private_key
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> cryptography.hazmat.primitives.serialization <span style="color:#ff79c6">import</span> Encoding
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> cryptography.hazmat.primitives.serialization <span style="color:#ff79c6">import</span> PublicFormat
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> cryptography.hazmat.backends <span style="color:#ff79c6">import</span> default_backend
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> datetime <span style="color:#ff79c6">import</span> timedelta, timezone, datetime
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> getpass <span style="color:#ff79c6">import</span> getpass
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># This class relies on the PyJWT module (https://pypi.org/project/PyJWT/).</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> jwt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger <span style="color:#ff79c6">=</span> logging<span style="color:#ff79c6">.</span>getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">try</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> Text
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">except</span> ImportError:
</span></span><span style="display:flex;"><span>    logger<span style="color:#ff79c6">.</span>debug(<span style="color:#f1fa8c">&#39;# Python 3.5.0 and 3.5.1 have incompatible typing modules.&#39;</span>, exc_info<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">from</span> typing_extensions <span style="color:#ff79c6">import</span> Text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ISSUER <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;iss&#34;</span>
</span></span><span style="display:flex;"><span>EXPIRE_TIME <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;exp&#34;</span>
</span></span><span style="display:flex;"><span>ISSUE_TIME <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;iat&#34;</span>
</span></span><span style="display:flex;"><span>SUBJECT <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;sub&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># If you generated an encrypted private key, implement this method to return</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># the passphrase for decrypting your private key. As an example, this function</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># prompts the user for the passphrase.</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_private_key_passphrase</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> getpass(<span style="color:#f1fa8c">&#39;Passphrase for private key: &#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">JWTGenerator</span>(<span style="color:#8be9fd;font-style:italic">object</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Creates and signs a JWT with the specified private key file, username, and account identifier. The JWTGenerator keeps the
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    generated token and only regenerates the token if a specified period of time has passed.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    LIFETIME <span style="color:#ff79c6">=</span> timedelta(minutes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">59</span>)  <span style="color:#6272a4"># The tokens will have a 59 minute lifetime</span>
</span></span><span style="display:flex;"><span>    RENEWAL_DELTA <span style="color:#ff79c6">=</span> timedelta(minutes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">54</span>)  <span style="color:#6272a4"># Tokens will be renewed after 54 minutes</span>
</span></span><span style="display:flex;"><span>    ALGORITHM <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;RS256&#34;</span>  <span style="color:#6272a4"># Tokens will be generated using RSA with SHA256</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> __init__(self, account: Text, user: Text, private_key_file_path: Text,
</span></span><span style="display:flex;"><span>                 lifetime: timedelta <span style="color:#ff79c6">=</span> LIFETIME, renewal_delay: timedelta <span style="color:#ff79c6">=</span> RENEWAL_DELTA):
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        __init__ creates an object that generates JWTs for the specified user, account identifier, and private key.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :param account: Your Snowflake account identifier. See https://docs.snowflake.com/en/user-guide/admin-account-identifier.html. Note that if you are using the account locator, exclude any region information from the account locator.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :param user: The Snowflake username.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :param private_key_file_path: Path to the private key file used for signing the JWTs.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :param lifetime: The number of minutes (as a timedelta) during which the key will be valid.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :param renewal_delay: The number of minutes (as a timedelta) from now after which the JWT generator should renew the JWT.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#ff79c6">.</span>info(
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;&#34;&#34;Creating JWTGenerator with arguments
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            account : </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">, user : </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">, lifetime : </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">, renewal_delay : </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#34;&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>            account, user, lifetime, renewal_delay)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># Construct the fully qualified name of the user in uppercase.</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>account <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>prepare_account_name_for_jwt(account)
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>user <span style="color:#ff79c6">=</span> user<span style="color:#ff79c6">.</span>upper()
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>qualified_username <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>account <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;.&#34;</span> <span style="color:#ff79c6">+</span> self<span style="color:#ff79c6">.</span>user
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>lifetime <span style="color:#ff79c6">=</span> lifetime
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>renewal_delay <span style="color:#ff79c6">=</span> renewal_delay
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>private_key_file_path <span style="color:#ff79c6">=</span> private_key_file_path
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>renew_time <span style="color:#ff79c6">=</span> datetime<span style="color:#ff79c6">.</span>now(timezone<span style="color:#ff79c6">.</span>utc)
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>token <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># Load the private key from the specified file.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">with</span> <span style="color:#8be9fd;font-style:italic">open</span>(self<span style="color:#ff79c6">.</span>private_key_file_path, <span style="color:#f1fa8c">&#39;rb&#39;</span>) <span style="color:#ff79c6">as</span> pem_in:
</span></span><span style="display:flex;"><span>            pemlines <span style="color:#ff79c6">=</span> pem_in<span style="color:#ff79c6">.</span>read()
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4"># Try to access the private key without a passphrase.</span>
</span></span><span style="display:flex;"><span>                self<span style="color:#ff79c6">.</span>private_key <span style="color:#ff79c6">=</span> load_pem_private_key(pemlines, <span style="color:#ff79c6">None</span>, default_backend())
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">except</span> TypeError:
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4"># If that fails, provide the passphrase returned from get_private_key_passphrase().</span>
</span></span><span style="display:flex;"><span>                self<span style="color:#ff79c6">.</span>private_key <span style="color:#ff79c6">=</span> load_pem_private_key(pemlines, get_private_key_passphrase()<span style="color:#ff79c6">.</span>encode(), default_backend())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">prepare_account_name_for_jwt</span>(self, raw_account: Text) <span style="color:#ff79c6">-&gt;</span> Text:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Prepare the account identifier for use in the JWT.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        For the JWT, the account identifier must not include the subdomain or any region or cloud provider information.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :param raw_account: The specified account identifier.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :return: The account identifier in a form that can be used to generate JWT.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        account <span style="color:#ff79c6">=</span> raw_account
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> <span style="color:#f1fa8c">&#39;.global&#39;</span> <span style="color:#ff79c6">in</span> account:
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Handle the general case.</span>
</span></span><span style="display:flex;"><span>            idx <span style="color:#ff79c6">=</span> account<span style="color:#ff79c6">.</span>find(<span style="color:#f1fa8c">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> idx <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span>:
</span></span><span style="display:flex;"><span>                account <span style="color:#ff79c6">=</span> account[<span style="color:#bd93f9">0</span>:idx]
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Handle the replication case.</span>
</span></span><span style="display:flex;"><span>            idx <span style="color:#ff79c6">=</span> account<span style="color:#ff79c6">.</span>find(<span style="color:#f1fa8c">&#39;-&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> idx <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span>:
</span></span><span style="display:flex;"><span>                account <span style="color:#ff79c6">=</span> account[<span style="color:#bd93f9">0</span>:idx]
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># Use uppercase for the account identifier.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> account<span style="color:#ff79c6">.</span>upper()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_token</span>(self) <span style="color:#ff79c6">-&gt;</span> Text:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Generates a new JWT. If a JWT has been already been generated earlier, return the previously generated token unless the
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        specified renewal time has passed.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :return: the new token
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        now <span style="color:#ff79c6">=</span> datetime<span style="color:#ff79c6">.</span>now(timezone<span style="color:#ff79c6">.</span>utc)  <span style="color:#6272a4"># Fetch the current time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># If the token has expired or doesn&#39;t exist, regenerate the token.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> self<span style="color:#ff79c6">.</span>token <span style="color:#ff79c6">is</span> <span style="color:#ff79c6">None</span> <span style="color:#ff79c6">or</span> self<span style="color:#ff79c6">.</span>renew_time <span style="color:#ff79c6">&lt;=</span> now:
</span></span><span style="display:flex;"><span>            logger<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Generating a new token because the present time (</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">) is later than the renewal time (</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">)&#34;</span>,
</span></span><span style="display:flex;"><span>                        now, self<span style="color:#ff79c6">.</span>renew_time)
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Calculate the next time we need to renew the token.</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#ff79c6">.</span>renew_time <span style="color:#ff79c6">=</span> now <span style="color:#ff79c6">+</span> self<span style="color:#ff79c6">.</span>renewal_delay
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Prepare the fields for the payload.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Generate the public key fingerprint for the issuer in the payload.</span>
</span></span><span style="display:flex;"><span>            public_key_fp <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>calculate_public_key_fingerprint(self<span style="color:#ff79c6">.</span>private_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Create our payload</span>
</span></span><span style="display:flex;"><span>            payload <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4"># Set the issuer to the fully qualified username concatenated with the public key fingerprint.</span>
</span></span><span style="display:flex;"><span>                ISSUER: self<span style="color:#ff79c6">.</span>qualified_username <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;.&#39;</span> <span style="color:#ff79c6">+</span> public_key_fp,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4"># Set the subject to the fully qualified username.</span>
</span></span><span style="display:flex;"><span>                SUBJECT: self<span style="color:#ff79c6">.</span>qualified_username,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4"># Set the issue time to now.</span>
</span></span><span style="display:flex;"><span>                ISSUE_TIME: now,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4"># Set the expiration time, based on the lifetime specified for this object.</span>
</span></span><span style="display:flex;"><span>                EXPIRE_TIME: now <span style="color:#ff79c6">+</span> self<span style="color:#ff79c6">.</span>lifetime
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Regenerate the actual token</span>
</span></span><span style="display:flex;"><span>            token <span style="color:#ff79c6">=</span> jwt<span style="color:#ff79c6">.</span>encode(payload, key<span style="color:#ff79c6">=</span>self<span style="color:#ff79c6">.</span>private_key, algorithm<span style="color:#ff79c6">=</span>JWTGenerator<span style="color:#ff79c6">.</span>ALGORITHM)
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># If you are using a version of PyJWT prior to 2.0, jwt.encode returns a byte string, rather than a string.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># If the token is a byte string, convert it to a string.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">isinstance</span>(token, <span style="color:#8be9fd;font-style:italic">bytes</span>):
</span></span><span style="display:flex;"><span>              token <span style="color:#ff79c6">=</span> token<span style="color:#ff79c6">.</span>decode(<span style="color:#f1fa8c">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>            self<span style="color:#ff79c6">.</span>token <span style="color:#ff79c6">=</span> token
</span></span><span style="display:flex;"><span>            logger<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Generated a JWT with the following payload: </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#34;</span>, jwt<span style="color:#ff79c6">.</span>decode(self<span style="color:#ff79c6">.</span>token, key<span style="color:#ff79c6">=</span>self<span style="color:#ff79c6">.</span>private_key<span style="color:#ff79c6">.</span>public_key(), algorithms<span style="color:#ff79c6">=</span>[JWTGenerator<span style="color:#ff79c6">.</span>ALGORITHM]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> self<span style="color:#ff79c6">.</span>token
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">calculate_public_key_fingerprint</span>(self, private_key: Text) <span style="color:#ff79c6">-&gt;</span> Text:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Given a private key in PEM format, return the public key fingerprint.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :param private_key: private key string
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        :return: public key fingerprint
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># Get the raw bytes of public key.</span>
</span></span><span style="display:flex;"><span>        public_key_raw <span style="color:#ff79c6">=</span> private_key<span style="color:#ff79c6">.</span>public_key()<span style="color:#ff79c6">.</span>public_bytes(Encoding<span style="color:#ff79c6">.</span>DER, PublicFormat<span style="color:#ff79c6">.</span>SubjectPublicKeyInfo)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># Get the sha256 hash of the raw bytes.</span>
</span></span><span style="display:flex;"><span>        sha256hash <span style="color:#ff79c6">=</span> hashlib<span style="color:#ff79c6">.</span>sha256()
</span></span><span style="display:flex;"><span>        sha256hash<span style="color:#ff79c6">.</span>update(public_key_raw)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># Base64-encode the value and prepend the prefix &#39;SHA256:&#39;.</span>
</span></span><span style="display:flex;"><span>        public_key_fp <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;SHA256:&#39;</span> <span style="color:#ff79c6">+</span> base64<span style="color:#ff79c6">.</span>b64encode(sha256hash<span style="color:#ff79c6">.</span>digest())<span style="color:#ff79c6">.</span>decode(<span style="color:#f1fa8c">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>        logger<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Public key fingerprint is </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#34;</span>, public_key_fp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> public_key_fp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">main</span>():
</span></span><span style="display:flex;"><span>    logging<span style="color:#ff79c6">.</span>basicConfig(stream<span style="color:#ff79c6">=</span>sys<span style="color:#ff79c6">.</span>stdout, level<span style="color:#ff79c6">=</span>logging<span style="color:#ff79c6">.</span>INFO)
</span></span><span style="display:flex;"><span>    cli_parser <span style="color:#ff79c6">=</span> argparse<span style="color:#ff79c6">.</span>ArgumentParser()
</span></span><span style="display:flex;"><span>    cli_parser<span style="color:#ff79c6">.</span>add_argument(<span style="color:#f1fa8c">&#39;--account&#39;</span>, required<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, help<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;The account identifier (e.g. &#34;myorganization-myaccount&#34; for &#34;myorganization-myaccount.snowflakecomputing.com&#34;).&#39;</span>)
</span></span><span style="display:flex;"><span>    cli_parser<span style="color:#ff79c6">.</span>add_argument(<span style="color:#f1fa8c">&#39;--user&#39;</span>, required<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, help<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;The user name.&#39;</span>)
</span></span><span style="display:flex;"><span>    cli_parser<span style="color:#ff79c6">.</span>add_argument(<span style="color:#f1fa8c">&#39;--private_key_file_path&#39;</span>, required<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, help<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;Path to the private key file used for signing the JWT.&#39;</span>)
</span></span><span style="display:flex;"><span>    cli_parser<span style="color:#ff79c6">.</span>add_argument(<span style="color:#f1fa8c">&#39;--lifetime&#39;</span>, <span style="color:#8be9fd;font-style:italic">type</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">int</span>, default<span style="color:#ff79c6">=</span><span style="color:#bd93f9">59</span>, help<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;The number of minutes that the JWT should be valid for.&#39;</span>)
</span></span><span style="display:flex;"><span>    cli_parser<span style="color:#ff79c6">.</span>add_argument(<span style="color:#f1fa8c">&#39;--renewal_delay&#39;</span>, <span style="color:#8be9fd;font-style:italic">type</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">int</span>, default<span style="color:#ff79c6">=</span><span style="color:#bd93f9">54</span>, help<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;The number of minutes before the JWT generator should produce a new JWT.&#39;</span>)
</span></span><span style="display:flex;"><span>    args <span style="color:#ff79c6">=</span> cli_parser<span style="color:#ff79c6">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    token <span style="color:#ff79c6">=</span> JWTGenerator(args<span style="color:#ff79c6">.</span>account, args<span style="color:#ff79c6">.</span>user, args<span style="color:#ff79c6">.</span>private_key_file_path, timedelta(minutes<span style="color:#ff79c6">=</span>args<span style="color:#ff79c6">.</span>lifetime), timedelta(minutes<span style="color:#ff79c6">=</span>args<span style="color:#ff79c6">.</span>renewal_delay))<span style="color:#ff79c6">.</span>get_token()
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;JWT:&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(token)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>å¼•æ•°ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè­˜åˆ¥å­ã‚„Snowflakeã®ãƒ¦ãƒ¼ã‚¶ã€æœ€åˆã«ä½œæˆã—ãŸç§˜å¯†éµã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>python3 sql-api-generate-jwt.py --account<span style="color:#ff79c6">=</span>&lt;ACCOUNTå&gt; --user<span style="color:#ff79c6">=</span>sqlapiuser --private_key_file_path<span style="color:#ff79c6">=</span>/Users/jimazato/.ssh/snowflake_tf_snow_key.p8
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(base) jimazato@CJ2VQ9Y2M1 sqlapi % python3 sql-api-generate-jwt.py --account=&lt;ACCOUNTå&gt; --user=sqlapiuser --private_key_file_path=/Users/jimazato/.ssh/snowflake_tf_snow_key.p8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INFO:__main__:Creating JWTGenerator with arguments
</span></span><span style="display:flex;"><span>            account : &lt;ACCOUNTå&gt;, user : sqlapiuser, lifetime : 0:59:00, renewal_delay : 0:54:00
</span></span><span style="display:flex;"><span>INFO:__main__:Generating a new token because the present time (2022-12-28 07:00:24.553334+00:00) is later than the renewal time (2022-12-28 07:00:24.508806+00:00)
</span></span><span style="display:flex;"><span>INFO:__main__:Public key fingerprint is SHA256:maG2a3wOxVnX0cGmhc5SRmWpRzzK5JuNjUm98JRGa1k=
</span></span><span style="display:flex;"><span>INFO:__main__:Generated a JWT with the following payload: {&#39;iss&#39;: &#39;&lt;ACCOUNTå&gt;.sqlapiuser.SHA256:maG2a3wOxVnX0cGmhc5SRmWpRzzK5JuNjUm98JRGa1k=&#39;, &#39;sub&#39;: &#39;&lt;ACCOUNTå&gt;.sqlapiuser&#39;, &#39;iat&#39;: 1672210824, &#39;exp&#39;: 1672214364}
</span></span><span style="display:flex;"><span>JWT:
</span></span><span style="display:flex;"><span>eyJ0 (çœç•¥) ixwFE-Ww
</span></span></code></pre></div><p>Curlã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œã€‚JWTã®ã¨ã“ã‚ã§å‡ºåŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’<code>Authorization: Bearer</code>ã«æŒ‡å®šã™ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl -i -X POST <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    -H <span style="color:#f1fa8c">&#34;Content-Type: application/json&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    -H <span style="color:#f1fa8c">&#34;Authorization: Bearer &lt;ã“ã“ã«JWTã®å€¤ã‚’è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ&gt;&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    -H <span style="color:#f1fa8c">&#34;Accept: application/json&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    -H <span style="color:#f1fa8c">&#34;User-Agent: myApplicationName/1.0&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    -H <span style="color:#f1fa8c">&#34;X-Snowflake-Authorization-Token-Type: KEYPAIR_JWT&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    -d <span style="color:#f1fa8c">&#34;{\&#34;statement\&#34;: \&#34;SELECT CURRENT_REGION()\&#34;}&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    <span style="color:#f1fa8c">&#34;https://&lt;ACCOUNTå&gt;.snowflakecomputing.com/api/v2/statements&#34;</span>
</span></span></code></pre></div><h4 id="ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµæœ">ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµæœ</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>HTTP/1.1 <span style="color:#bd93f9">200</span> OK
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>Date: Wed, <span style="color:#bd93f9">28</span> Dec <span style="color:#bd93f9">2022</span> 07:15:28 GMT
</span></span><span style="display:flex;"><span>Expect-CT: enforce, max-age<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3600</span>
</span></span><span style="display:flex;"><span>Link: &lt;/api/v2/statements/01a943f3-0000-a91b-0000-a6f10012c07a?requestId<span style="color:#ff79c6">=</span>9c8671e3-9d0a-47a3-998e-9f01472d6435&amp;<span style="color:#8be9fd;font-style:italic">partition</span><span style="color:#ff79c6">=</span>0&gt;; <span style="color:#8be9fd;font-style:italic">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;first&#34;</span>,&lt;/api/v2/statements/01a943f3-0000-a91b-0000-a6f10012c07a?requestId<span style="color:#ff79c6">=</span>a7facb2c-4fc3-4503-9d08-bab3ed427c27&amp;<span style="color:#8be9fd;font-style:italic">partition</span><span style="color:#ff79c6">=</span>0&gt;; <span style="color:#8be9fd;font-style:italic">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;last&#34;</span>
</span></span><span style="display:flex;"><span>Strict-Transport-Security: max-age<span style="color:#ff79c6">=</span><span style="color:#bd93f9">31536000</span>
</span></span><span style="display:flex;"><span>Vary: Accept-Encoding, User-Agent
</span></span><span style="display:flex;"><span>X-Content-Type-Options: nosniff
</span></span><span style="display:flex;"><span>X-Country: Japan
</span></span><span style="display:flex;"><span>X-Frame-Options: deny
</span></span><span style="display:flex;"><span>X-XSS-Protection: : 1; <span style="color:#8be9fd;font-style:italic">mode</span><span style="color:#ff79c6">=</span>block
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#bd93f9">891</span>
</span></span><span style="display:flex;"><span>Connection: keep-alive
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;resultSetMetaData&#34;</span> : <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;numRows&#34;</span> : 1,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;format&#34;</span> : <span style="color:#f1fa8c">&#34;jsonv2&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;partitionInfo&#34;</span> : <span style="color:#ff79c6">[</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;rowCount&#34;</span> : 1,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;uncompressedSize&#34;</span> : <span style="color:#bd93f9">29</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;rowType&#34;</span> : <span style="color:#ff79c6">[</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;name&#34;</span> : <span style="color:#f1fa8c">&#34;CURRENT_REGION()&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;database&#34;</span> : <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;schema&#34;</span> : <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;table&#34;</span> : <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;byteLength&#34;</span> : 16777216,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;type&#34;</span> : <span style="color:#f1fa8c">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;scale&#34;</span> : null,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;precision&#34;</span> : null,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;nullable&#34;</span> : true,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;collation&#34;</span> : null,
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;length&#34;</span> : <span style="color:#bd93f9">16777216</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;data&#34;</span> : <span style="color:#ff79c6">[</span> <span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#34;PUBLIC.AWS_AP_NORTHEAST_1&#34;</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;code&#34;</span> : <span style="color:#f1fa8c">&#34;090001&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;statementStatusUrl&#34;</span> : <span style="color:#f1fa8c">&#34;/api/v2/statements/01a943f3-0000-a91b-0000-a6f10012c07a?requestId=10c8547f-3a93-438a-88f1-94788ec3755e&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;requestId&#34;</span> : <span style="color:#f1fa8c">&#34;10c8547f-3a93-438a-88f1-94788ec3755e&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;sqlState&#34;</span> : <span style="color:#f1fa8c">&#34;00000&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;statementHandle&#34;</span> : <span style="color:#f1fa8c">&#34;01a943f3-0000-a91b-0000-a6f10012c07a&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;message&#34;</span> : <span style="color:#f1fa8c">&#34;Statement executed successfully.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;createdOn&#34;</span> : <span style="color:#bd93f9">1672211728759</span>
</span></span></code></pre></div><h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li><a href="https://docs.snowflake.com/ja/developer-guide/sql-api/index.html">Snowflake SQL API â€” Snowflake Documentation</a></li>
</ul>

      </div>
    </div>

    
    
    <nav class="prev-next-nav">
      
      <a href="https://zatoima.github.io/snowflake-connector-python-lambda-use/" class="prev-next-link prev-link">
        <span class="prev-next-label">â† å‰ã®è¨˜äº‹</span>
        <span class="prev-next-title">snowflake-connector-pythonã‚’Lambdaã§ä½¿ç”¨ã™ã‚‹äº‹å‰æº–å‚™ãƒ¡ãƒ¢</span>
      </a>
      
      
      <a href="https://zatoima.github.io/aws-lambda-cloudwatch-logs-not-write/" class="prev-next-link next-link">
        <span class="prev-next-label">æ¬¡ã®è¨˜äº‹ â†’</span>
        <span class="prev-next-title">Lambdaã§ä¸€å‘ã«CloudWatch logsã®ãƒ­ã‚°ãŒæ›¸ãè¾¼ã¾ã‚Œãªã„æ™‚ã®ç¢ºèªãƒã‚¤ãƒ³ãƒˆ</span>
      </a>
      
    </nav>
    

    
<div class="share-buttons">
  <span class="share-label">å…±æœ‰:</span>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fzatoima.github.io%2fsnowflake-sql-api-try%2f&text=SQL&#43;API%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6Snowflake%E3%81%ABSQL%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B" target="_blank" rel="noopener noreferrer" class="share-btn share-twitter" aria-label="Xã§å…±æœ‰">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
  </a>
  <a href="https://b.hatena.ne.jp/entry/https://zatoima.github.io/snowflake-sql-api-try/" target="_blank" rel="noopener noreferrer" class="share-btn share-hatena" aria-label="ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ ">B!</a>
</div>



<div class="related-articles">
  <h2 class="related-articles-title">é–¢é€£ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„è¨˜äº‹</h2>
  <ul class="related-list">
    
    <li><a href="/snowflake-excel-sql-execute-macro-button/">Excelã‹ã‚‰Snowflakeã¸SQLã‚’å®Ÿè¡Œã™ã‚‹ãƒã‚¯ãƒ­ãƒ›ã‚™ã‚¿ãƒ³ã‚’ä½œæˆã™ã‚‹</a></li>
    
    <li><a href="/snowflake-m1-mac-excel-connect/">M1 Macã‹ã‚‰Snowflakeã¸Excelã¦ã‚™ODBCæ¥ç¶šã™ã‚‹</a></li>
    
    <li><a href="/snowflake-anaconda-snowflake-conector-python-install/">Anacondaç’°å¢ƒã«snowflake-connector-pythonã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></li>
    
    <li><a href="/snowflake-extract-name-position-function/">Snowflakeã§åå­—ã¨åå‰ã‚’æŠ½å‡ºã™ã‚‹(POSITIONé–¢æ•°)</a></li>
    
    <li><a href="/snowflake-snowsql-install-howto/">snowsqlã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></li>
    
  </ul>
</div>




<div class="post-tags">
  
  <a href="https://zatoima.github.io/blog/snowflake/" class="tag-badge"><img src="/images/tags/snowflake.svg" alt="Snowflake" class="tag-badge-icon" loading="lazy">Snowflake</a>
  
</div>


  </article>

  
  <aside class="article-sidebar">
    <div class="toc-container">
      <div class="toc-title">ç›®æ¬¡</div>
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ã‚­ãƒ¼ãƒšã‚¢èªè¨¼ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šå¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆ">ã‚­ãƒ¼ãƒšã‚¢èªè¨¼ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šå¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆ</a>
          <ul>
            <li><a href="#æ¥ç¶šç¢ºèªã‚’è¡Œã†">æ¥ç¶šç¢ºèªã‚’è¡Œã†</a></li>
          </ul>
        </li>
        <li><a href="#jwtç”Ÿæˆã‚’è¡Œã†">JWTç”Ÿæˆã‚’è¡Œã†</a>
          <ul>
            <li><a href="#ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµæœ">ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµæœ</a></li>
          </ul>
        </li>
        <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  </aside>
  
</div>

    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <div class="footer-links">
          <a href="/">ãƒ›ãƒ¼ãƒ </a>
          <a href="/blog/">è¨˜äº‹ä¸€è¦§</a>
          <a href="/tags/">ã‚¿ã‚°ä¸€è¦§</a>
          <a href="/about/">About</a>
        </div>
        <div class="footer-copyright">Copyright Â© 2019, zatoima.</div>
      </div>
    </footer>
  </div>
  <script src="/js/lightbox.js" defer></script>
  <script src="/js/toc-highlight.js" defer></script>
  <script src="/js/code-copy.js" defer></script>
  <script src="/js/dark-mode.js" defer></script>
  <script src="/js/mobile-nav.js" defer></script>
  <script src="/js/search.js" defer></script>
</body>

</html>
